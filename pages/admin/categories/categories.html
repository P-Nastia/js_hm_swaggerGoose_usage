<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link href="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/flowbite@3.1.2/dist/flowbite.min.js"></script>
    <link href="/css/style.css" rel="stylesheet" />
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.14.0/qs.min.js" integrity="sha512-6yLIYbXqyvjSDYNO1pgBRjwWPBw66kMOb+sHqrvn457+iJiret0PeHzUlpLKHH0fYzX9bxGtPDqQ84xKrhEYSQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <title></title>
</head>
<body>
    <script src="/js/site.js"></script>
    <script>loadDOM('/partials/header.html');</script>
    <script>loadDOM('/partials/asideAdminPanel.html');</script>
    <br />
    <div id="addItemPage" style="margin:80px 50px 0 300px">

        <div class="max-w-md mx-auto my-6" id="searchCategoryForm">
            <div class="relative">
                <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                    <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
                    </svg>
                </div>
                <input type="text" id="searchInput" style="padding-left:50px" aria-describedby="floating_helper_text" class="block rounded-t-lg px-2.5 pb-2.5 pt-5 w-full text-md text-gray-900 bg-gray-50 dark:bg-gray-700 border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer" placeholder=" " />
                <label for="searchInput" style="margin-left:50px" class=" absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-4 scale-75 top-4 z-10 origin-[0] start-2.5 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-4 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto">Categories</label>
                <button onclick="SearchCategories()" type="submit" class="text-white absolute end-2.5 bottom-2.5 bg-pink-600 hover:bg-pink-800 focus:ring-4 focus:outline-none focus:ring-pink-300 font-medium rounded-lg text-sm px-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Search</button>
            </div>
        </div>

        <div class="relative overflow-x-auto shadow-md sm:rounded-lg">


            <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
                <thead class="text-xs text-gray-700 uppercase bg-pink-200 dark:bg-gray-700 dark:text-gray-400">
                    <tr>
                        <th scope="col" class="px-16 py-3">
                            <span class="sr-only">Photo</span>
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Name
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Slug
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Priority
                        </th>
                        <th scope="col" class="px-6 py-3">
                            Action
                        </th>
                    </tr>
                </thead>
                <tbody id="listCategories">
                </tbody>
            </table>
        </div>

        <nav aria-label="Page navigation example" class="my-6 flex justify-center">
            <ul class="inline-flex -space-x-px text-base h-10" id="pagination">
            </ul>
        </nav>
    </div>

    <script>
        let search = {
            page: 1,
            title: ''
        };

        async function fetchCategories() {
            try {


                console.log("qs", Qs.stringify(search));
                const query = Qs.stringify(search);
                const pagination = document.getElementById('pagination');

                const response = await axios.get(`https://goose.itstep.click/api/Categories/search?${query}`, {
                    headers: {
                        'Accept': '*/*'
                    }
                });
                const { data } = response;
                const { categories, pages, total, currentPage } = data;

                loadPagination(pages, currentPage);

                const listCategories = document.getElementById('listCategories');
                listCategories.innerHTML = "";

                categories.forEach(item => {
                    listCategories.innerHTML += `
                        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 border-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600">
        <td class="p-4">
            <img src="https://goose.itstep.click/images/100_${item.image}" alt="Apple Watch">
        </td>
        <td class="px-6 py-4 font-semibold text-gray-900 dark:text-white">
            ${item.title}
        </td>
        <td class="px-6 py-4 font-semibold text-gray-900 dark:text-white">
            ${item.urlSlug}
        </td>
        <td class="px-6 py-4 font-semibold text-gray-900 dark:text-white">
            ${item.priority}
        </td>
        <td class="px-6 py-4">
            <a href="#" class="font-medium text-red-600 dark:text-red-500 hover:underline">Remove</a>
        </td>
</tr>
                        `;

                });
                searchDataPage();
            } catch (error) {
                console.error('Error fetching categories:', error);
            }
        }

        fetchCategories();

        function searchDataPage() {
            document.querySelectorAll('[data-page]').forEach(element => {
                element.addEventListener('click', event => {
                    event.preventDefault();
                    const page = event.target.getAttribute('data-page');
                    search.page = page;
                    fetchCategories();
                    console.log('Вибрано сторінку:', page);
                });
            });
        }

        function loadPagination(pages, currentPage) {
            pagination.innerHTML = `
<li>
        <a href="#" data-page="${1}" class="flex items-center justify-center px-4 h-10 ms-0 leading-tight text-gray-500 bg-white border border-e-0 border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">Previous</a>
</li>
`;
            for (let i = 1; i <= pages; i++) {
                if (i == currentPage) {
                    pagination.innerHTML += `
                        <li>
          <a href="#" aria-current="page" data-page="${i}" class="z-10 flex items-center justify-center px-4 h-10 leading-tight text-blue-600 border border-blue-300 bg-blue-50 hover:bg-blue-100 hover:text-blue-700 dark:border-gray-700 dark:bg-gray-700 dark:text-white">${i}</a>
        </li>`;
                }
                else {
                    pagination.innerHTML += `
         <li>
             <a href="#"  data-page="${i}" class="flex items-center justify-center px-4 h-10 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">${i}</a>
         </li>
         `;
                }
            }
            pagination.innerHTML += `
<li>
        <a href="#" data-page="${pages}" class="flex items-center justify-center px-4 h-10 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">Next</a>
</li>
`;

        }

        function SearchCategories() {
            search.title = document.getElementById('searchInput').value;
            fetchCategories();
        }
    </script>


</body>
</html>